<html>
    <head>
        <style>
            html {
                font-family:"Open Sans","Helvetica","Arial",sans-serif;
                color: #1E1E38;
            }
            .locations {
                height: 50%;
            }
            .location-form input {
                display: block;
                margin: 20px 0;
            }
            .locations__body h2 {
                display: inline-block;
                margin-right: 20px;
            }
        </style>
    </head>
    <body>
        <div class="locations map" id="map"></div>
        <div class="locations locations__body">
            <h2>I want to go to there:</h2><span id="current-position"></span>
            
            <div class="location-form">
                <textarea id="location-description" rows="6" placeholder="Notes"></textarea>
                <input type="submit" value="Save Place"/>
            </div>

            <h2>M'Places</h2>
            <div class="places-list-container">

            </div>
        </div>
        <script>
            
            // Iniciate map
            function initMap() {
                let currentMarker;
                let currentPosition = { lat:40.7620582, lng:-73.9805203, placeId: null };

                function clearMarkers() {
                    if (currentMarker) {
                        currentMarker.setMap(null);
                    }
                }
                
                // Create a marker and set its position.
                function addMarker(map, position, title) {
                    
                    currentMarker = new google.maps.Marker({
                        map: map,
                        position: position,
                        title: title
                    });

                    if (map.zoom < 18) {
                        map.setZoom(18);
                    }
                }

                // Map click handler
                function onMapClick (position) {
                    currentPosition.lat = position.latLng.lat();
                    currentPosition.lng = position.latLng.lng();;
                    currentPosition.placeId = position.placeId;

                    clearMarkers();
                    addMarker(this, currentPosition, 'Test');

                    document.querySelector('#current-position')
                        .innerHTML = `lat:${currentPosition.lat}, long:${currentPosition.lng}`;
                }

                if (!navigator.geolocation) {
                    console.log('location not supported');
                    return;
                }

                // Create a map object and update the DOM
                const map = new google.maps.Map(document.getElementById('map'), {
                    center: currentPosition,
                    zoom: 18
                });

                map.addListener('click', onMapClick);

                // Set current location on map
                navigator.geolocation.getCurrentPosition( position => {
                    currentPosition.lat = position.coords.latitude;
                    currentPosition.lng = position.coords.longitude;
                    
                    map.setCenter(currentPosition);
                    addMarker(map, currentPosition, 'I\'m here');
                });
            }


        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDM9yoWb3ehc6NwnpjvAKxLAB2fGRytpnQ&callback=initMap" async defer></script>
    </body>
</html>